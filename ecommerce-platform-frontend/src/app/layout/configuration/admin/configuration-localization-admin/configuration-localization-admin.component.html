<div class="configuration-container">
  <div class="admin-header-section list-header">
    <div class="admin-header-content">
      <div class="admin-title-section">
        <h1>
          <mat-icon class="title-icon">settings</mat-icon>
          {{ 'CONFIGURATION.TITLE' | translate }}
        </h1>
        <p class="admin-subtitle">{{ 'CONFIGURATION.ADMIN_SUBTITLE.UPDATE' | translate }}</p>
      </div>
    </div>
  </div>

  <div class="admin-content-card">
    <form (ngSubmit)="onSave()" [formGroup]="configurationForm" id="configurationForm">
      <div class="form-content">
        <mat-progress-bar *ngIf="saving" class="admin-save-progress" mode="indeterminate"></mat-progress-bar>

        <!-- BASIC SETTINGS -->
        <div class="form-section">
          <div class="section-header">
            <mat-icon>settings</mat-icon>
            <h3>{{ 'CONFIGURATION.BASIC_SETTINGS' | translate }}</h3>
          </div>

          <div class="form-row">
            <div class="form-field">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>{{ 'CONFIGURATION.THEME' | translate }}</mat-label>
                <input formControlName="theme" matInput required>
                <mat-error *ngIf="configurationForm.get('theme')?.hasError('required')">
                  {{ 'VALIDATION.REQUIRED' | translate }}
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-field">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>{{ 'CONFIGURATION.UPDATED_AT' | translate }}</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="updatedAt" readonly>
                <mat-datepicker-toggle matSuffix [for]="picker" disabled="true"></mat-datepicker-toggle>
                <mat-datepicker  #picker></mat-datepicker>
              </mat-form-field>
            </div>
          </div>

          <div class="form-row">
            <div class="form-field">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>{{ 'CONFIGURATION.CURRENCY' | translate }}</mat-label>
                <input matInput formControlName="currency" required>
                <mat-error *ngIf="configurationForm.get('currency')?.hasError('required')">
                  {{ 'VALIDATION.REQUIRED' | translate }}
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-field">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>{{ 'CONFIGURATION.DEFAULT_LANGUAGE' | translate }}</mat-label>
                <mat-select
                  formControlName="defaultLocale"
                  required
                  [compareWith]="compareLocales">

                  <!-- Show selected language with flag -->
                  <mat-select-trigger>
                    <ng-container *ngIf="configurationForm.get('defaultLocale')?.value">
                      <img
                        [src]="'assets/flags/' + configurationForm.get('defaultLocale')?.value.regionCode.toLowerCase() + '.svg'"
                        class="locale-flag"
                        alt="flag">
                      {{ translateLocale(configurationForm.get('defaultLocale')?.value) }}
                    </ng-container>
                  </mat-select-trigger>

                  <!-- Options -->
                  <mat-option *ngFor="let locale of configurationForm.get('usedLocales')?.value" [value]="locale">
                    <img [src]="'assets/flags/' + locale.regionCode.toLowerCase() + '.svg'" class="locale-flag" alt="flag">
                    {{ translateLocale(locale) }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="configurationForm.get('defaultLocale')?.hasError('required')">
                  {{ 'VALIDATION.REQUIRED' | translate }}
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </div>

        <!-- AVAILABLE LOCALES -->
        <div class="form-section">
          <div class="section-header">
            <mat-icon>language</mat-icon>
            <h3>{{ 'CONFIGURATION.AVAILABLE_LOCALES' | translate }}</h3>
          </div>

          <div class="form-row">
            <div class="form-field full-width">
              <mat-form-field appearance="outline" class="form-field full-width">
                <mat-label>{{ 'CONFIGURATION.SELECT_LOCALES' | translate }}</mat-label>
                <mat-select formControlName="usedLocales" multiple>

                  <!-- Show selected languages with flags -->
                  <mat-select-trigger>
                    <div class="selected-locales-container">
                      <ng-container *ngFor="let locale of configurationForm.get('usedLocales')?.value; let last = last">
                        <div class="selected-locale-item">
                          <img
                            [src]="'assets/flags/' + locale.regionCode.toLowerCase() + '.svg'"
                            class="locale-flag"
                            alt="flag">
                          <span>{{ translateLocale(locale) }}</span>
                        </div>
                      </ng-container>
                    </div>
                  </mat-select-trigger>

                  <!-- Options -->
                  <mat-option *ngFor="let locale of inUseLocales" [value]="locale">
                    <img [src]="'assets/flags/' + locale.regionCode.toLowerCase() + '.svg'" class="locale-flag" alt="flag">
                    {{ translateLocale(locale) }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>
    </form>

    <!-- Action Bar -->
    <div class="admin-actions-bar">
      <div class="admin-action-buttons">
        <button (click)="onCancel()"
                color="warn"
                mat-stroked-button
                type="button"
                class="cancel-btn">
          <mat-icon>close</mat-icon>
          {{ 'COMMON.CANCEL' | translate }}
        </button>
        <button [disabled]="!configurationForm.valid || saving || !configurationForm.dirty"
                color="primary"
                form="configurationForm"
                mat-flat-button
                type="submit"
                class="save-btn">
          <mat-icon>save</mat-icon>
          {{ saving ? ('COMMON.SAVING' | translate) : ('COMMON.SAVE' | translate) }}
        </button>
      </div>
    </div>
  </div>
</div>
