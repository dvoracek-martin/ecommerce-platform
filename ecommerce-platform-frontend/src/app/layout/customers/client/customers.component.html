<div class="admin-container">
  <mat-card class="admin-card">
    <div class="admin-header-section">
      <div class="admin-header-content">
        <div class="admin-title-section">
          <h1>{{ 'CUSTOMER.TITLE' | translate }}</h1>
          <p class="admin-subtitle">{{ 'CUSTOMER.ADMIN_SUBTITLE.PROFILE' | translate }}</p>
        </div>
      </div>
    </div>

    <form (ngSubmit)="onSave()" [formGroup]="customerForm" class="form-one-column-wrapper" id="customerForm">
      <div class="form-content">
        <mat-progress-bar *ngIf="saving" class="admin-save-progress" mode="indeterminate"></mat-progress-bar>

        <div class="form-section">
          <h3 class="section-subtitle">
            <mat-icon>badge</mat-icon>
            {{ 'CUSTOMER.BASIC_INFO' | translate }}
          </h3>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.FIRST_NAME' | translate }}</mat-label>
              <input formControlName="firstName" matInput required
                     [placeholder]="'CUSTOMER.FIRST_NAME_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('firstName')?.hasError('required')">
                {{ 'USER_REGISTRATION.FIRST_NAME_REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.LAST_NAME' | translate }}</mat-label>
              <input formControlName="lastName" matInput required
                     [placeholder]="'CUSTOMER.LAST_NAME_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('lastName')?.hasError('required')">
                {{ 'USER_REGISTRATION.LAST_NAME_REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field" *ngIf="locales.length > 0">
              <mat-label>{{ 'CUSTOMER.PREFERRED_LANGUAGE' | translate }}</mat-label>
              <mat-select
                formControlName="preferredLanguageId"
                (selectionChange)="onLanguageChange($event.value)">

                <mat-select-trigger>
                  <ng-container *ngIf="selectedLanguage">
                    <img
                      [src]="'assets/flags/' + selectedLanguage.regionCode.toLowerCase() + '.svg'"
                      class="locale-flag"
                      alt="flag">
                    {{ translateLocale(selectedLanguage) }}
                  </ng-container>
                </mat-select-trigger>

                <mat-option *ngFor="let locale of locales" [value]="locale.id">
                  <img [src]="'assets/flags/' + locale.regionCode.toLowerCase() + '.svg'" class="locale-flag" alt="flag">
                  {{ translateLocale(locale) }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <div class="form-section" formGroupName="address">
          <h3 class="section-subtitle">
            <mat-icon>location_on</mat-icon>
            {{ 'CUSTOMER.SHIPPING_ADDRESS' | translate }}
          </h3>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field full-width">
              <mat-label>{{ 'CUSTOMER.PHONE' | translate }}</mat-label>
              <input formControlName="phone" matInput
                     [placeholder]="'CUSTOMER.PHONE_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('address.phone')?.hasError('pattern')">
                {{ 'CUSTOMER.PHONE_INVALID' | translate }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.STREET' | translate }}</mat-label>
              <input formControlName="street" matInput required
                     [placeholder]="'CUSTOMER.STREET_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('address.street')?.hasError('required')">
                {{ 'CUSTOMER.STREET_REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.HOUSE_NUMBER' | translate }}</mat-label>
              <input formControlName="houseNumber" matInput required
                     [placeholder]="'CUSTOMER.HOUSE_NUMBER_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('address.houseNumber')?.hasError('required')">
                {{ 'CUSTOMER.HOUSE_NUMBER_REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.CITY' | translate }}</mat-label>
              <input formControlName="city" matInput required
                     [placeholder]="'CUSTOMER.CITY_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('address.city')?.hasError('required')">
                {{ 'CUSTOMER.CITY_REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.ZIP_CODE' | translate }}</mat-label>
              <input formControlName="zipCode" matInput required
                     [placeholder]="'CUSTOMER.ZIP_CODE_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('address.zipCode')?.hasError('required')">
                {{ 'CUSTOMER.ZIP_CODE_REQUIRED' | translate }}
              </mat-error>
              <mat-error *ngIf="customerForm.get('address.zipCode')?.hasError('pattern')">
                {{ 'CUSTOMER.ZIP_CODE_NUMBERS_ONLY' | translate }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.COUNTRY' | translate }}</mat-label>
              <mat-select formControlName="country" required>
                <mat-option value="Switzerland">Switzerland</mat-option>
              </mat-select>
              <mat-error *ngIf="customerForm.get('address.country')?.hasError('required')">
                {{ 'CUSTOMER.COUNTRY_REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <div class="form-section">
          <div class="checkbox-group">
            <mat-checkbox formControlName="sameBillingAddress">
              {{ 'CUSTOMER.SAME_BILLING_ADDRESS' | translate }}
            </mat-checkbox>
          </div>
        </div>

        <div *ngIf="showBillingAddress" @slideDown class="form-section" formGroupName="billingAddress">
          <h3 class="section-subtitle">
            <mat-icon>business</mat-icon>
            {{ 'CUSTOMER.BILLING_ADDRESS' | translate }}
          </h3>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.FIRST_NAME' | translate }}</mat-label>
              <input formControlName="firstName" matInput required
                     [placeholder]="'CUSTOMER.FIRST_NAME_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('billingAddress.firstName')?.hasError('required')">
                {{ 'USER_REGISTRATION.FIRST_NAME_REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.LAST_NAME' | translate }}</mat-label>
              <input formControlName="lastName" matInput required
                     [placeholder]="'CUSTOMER.LAST_NAME_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('billingAddress.lastName')?.hasError('required')">
                {{ 'USER_REGISTRATION.LAST_NAME_REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field full-width">
              <mat-label>{{ 'CUSTOMER.PHONE' | translate }}</mat-label>
              <input formControlName="phone" matInput
                     [placeholder]="'CUSTOMER.PHONE_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('billingAddress.phone')?.hasError('pattern')">
                {{ 'CUSTOMER.PHONE_INVALID' | translate }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.STREET' | translate }}</mat-label>
              <input formControlName="street" matInput required
                     [placeholder]="'CUSTOMER.STREET_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('billingAddress.street')?.hasError('required')">
                {{ 'CUSTOMER.STREET_REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.HOUSE_NUMBER' | translate }}</mat-label>
              <input formControlName="houseNumber" matInput required
                     [placeholder]="'CUSTOMER.HOUSE_NUMBER_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('billingAddress.houseNumber')?.hasError('required')">
                {{ 'CUSTOMER.HOUSE_NUMBER_REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.CITY' | translate }}</mat-label>
              <input formControlName="city" matInput required
                     [placeholder]="'CUSTOMER.CITY_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('billingAddress.city')?.hasError('required')">
                {{ 'CUSTOMER.CITY_REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.ZIP_CODE' | translate }}</mat-label>
              <input formControlName="zipCode" matInput required
                     [placeholder]="'CUSTOMER.ZIP_CODE_PLACEHOLDER' | translate">
              <mat-error *ngIf="customerForm.get('billingAddress.zipCode')?.hasError('required')">
                {{ 'CUSTOMER.ZIP_CODE_REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>{{ 'CUSTOMER.COUNTRY' | translate }}</mat-label>
              <mat-select formControlName="country" required>
                <mat-option value="Switzerland">Switzerland</mat-option>
              </mat-select>
              <mat-error *ngIf="customerForm.get('billingAddress.country')?.hasError('required')">
                {{ 'CUSTOMER.COUNTRY_REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      </div>
    </form>

  </mat-card>
</div>

<div class="admin-actions-bar">
  <div class="admin-action-buttons-wrapper">
    <div class="admin-action-buttons">
      <button (click)="onCancel()"
              color="warn"
              mat-stroked-button
              type="button"
              class="cancel-btn">
        <mat-icon>close</mat-icon>
        {{ 'COMMON.CANCEL' | translate }}
      </button>
      <button [disabled]="!customerForm || customerForm.invalid || saving"
              color="primary"
              form="customerForm"
              mat-flat-button
              type="submit"
              class="save-btn">
        <mat-icon>save</mat-icon>
        {{ saving ? ('COMMON.SAVING' | translate) : ('COMMON.SAVE' | translate) }}
      </button>
    </div>
  </div>
</div>
