<div class="tags-container">
  <div class="admin-header-section">
    <div class="admin-header-content">
      <div class="admin-title-section">
        <h1>{{ 'TAGS.TITLE' | translate }}</h1>
        <p class="admin-subtitle">{{ 'TAGS.ADMIN_SUBTITLE' | translate }}</p>
      </div>

      <div class="admin-actions">
        <div class="admin-search-section">
          <div class="admin-search-container">
            <div class="admin-search-input-wrapper">
              <mat-icon class="admin-search-icon">search</mat-icon>
              <input
                [formControl]="searchControl"
                class="admin-search-input"
                matInput
                [placeholder]="'TAGS.SEARCH_PLACEHOLDER' | translate">
              <button
                (click)="clearSearch()"
                *ngIf="searchControl.value"
                class="admin-clear-button"
                mat-icon-button>
                <mat-icon>close</mat-icon>
              </button>
            </div>
          </div>

          <div class="admin-search-checkbox-wrapper">
            <mat-checkbox (change)="applyFilters()" [formControl]="activeSeControl" class="admin-active-checkbox">
              {{ 'TAGS.SHOW_ACTIVE' | translate }}
            </mat-checkbox>
          </div>
        </div>

        <button (click)="navigateToCreate()" class="admin-new-btn">
          <mat-icon>add</mat-icon>
          {{ 'TAGS.ADMIN.NEW_TITLE' | translate }}
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading-section">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    <div class="loading-text">{{ 'TAGS.LOADING' | translate }}</div>
  </div>

  <div *ngIf="error" class="error-section">
    <mat-icon class="error-icon" color="warn">error_outline</mat-icon>
    <div class="error-text">{{ error }}</div>
    <button (click)="navigateHome()" color="warn" mat-stroked-button>
      <mat-icon>arrow_back</mat-icon>
      {{ 'COMMON.BACK_TO_HOME' | translate }}
    </button>
  </div>

  <div *ngIf="!isLoading && !error && filteredTags.length === 0" class="no-tags-section">
    <mat-icon class="no-tags-icon">label_off</mat-icon>
    <div class="no-tags-text">{{ 'TAGS.NO_TAGS_FOUND' | translate }}</div>
    <button (click)="navigateToCreate()" class="admin-new-btn" mat-raised-button color="primary">
      <mat-icon>add</mat-icon>
      {{ 'TAGS.CREATE_FIRST_TAG' | translate }}
    </button>
  </div>

  <div *ngIf="!isLoading && !error && filteredTags.length > 0" class="tags-grid">
    <div
      *ngFor="let tag of filteredTags; trackBy: trackById"
      class="tag-card"
    >
      <div (click)="navigateToUpdate(tag.id)" class="card-link">
        <!-- Updated Tag Icon Container - Matching Modal Style -->
        <div class="tag-icon-container" [style.background]="tag.color">
          <div class="tag-icon-wrapper">
            <span *ngIf="isEmoji(tag.icon)" class="tag-emoji">{{ tag.icon }}</span>
            <mat-icon *ngIf="!isEmoji(tag.icon)" class="tag-material-icon">{{ tag.icon }}</mat-icon>
          </div>
        </div>

        <div class="tag-details">
          <div class="tag-header">
            <h2 class="tag-name">{{ tag.translatedName }}</h2>
            <div class="tag-status" [class.active]="tag.active" [class.inactive]="!tag.active">
              <mat-icon>{{ tag.active ? 'check_circle' : 'cancel' }}</mat-icon>
              {{ tag.active ? ('COMMON.ACTIVE' | translate) : ('COMMON.INACTIVE' | translate) }}
            </div>
          </div>

          <p class="tag-description">{{ tag.translatedDescription || ('TAGS.NO_DESCRIPTION' | translate) }}</p>

          <!-- Relations Information -->
          <div class="tag-relations">
            <!-- Categories -->
            <div *ngIf="tag.categories?.length" class="relation-section">
              <span class="relation-label">{{ 'TAGS.RELATIONS.CATEGORIES' | translate }}:</span>
              <div class="relation-tags">
                <span *ngFor="let category of tag.categories" class="relation-tag">
                  {{ category.translatedName }}
                </span>
              </div>
            </div>

            <!-- Products -->
            <div *ngIf="tag.products?.length" class="relation-section">
              <span class="relation-label">{{ 'TAGS.RELATIONS.PRODUCTS' | translate }}:</span>
              <div class="relation-tags">
                <span *ngFor="let product of tag.products" class="relation-tag">
                  {{ product.translatedName }}
                </span>
              </div>
            </div>

            <!-- Mixtures -->
            <div *ngIf="tag.mixtures?.length" class="relation-section">
              <span class="relation-label">{{ 'TAGS.RELATIONS.MIXTURES' | translate }}:</span>
              <div class="relation-tags">
                <span *ngFor="let mixture of tag.mixtures" class="relation-tag">
                  {{ mixture.translatedName }}
                </span>
              </div>
            </div>

            <!-- Empty Relations -->
            <div *ngIf="!tag.categories?.length && !tag.products?.length && !tag.mixtures?.length"
                 class="no-relations">
              {{ 'TAGS.NO_RELATIONS' | translate }}
            </div>
          </div>

          <div class="tag-priority">
            <mat-icon class="priority-icon">priority_high</mat-icon>
            <span class="priority-text">{{ 'TAGS.PRIORITY' | translate }}: {{ tag.priority }}</span>
          </div>
        </div>
      </div>

      <div class="tag-actions">
        <div class="relations-count">
          <span class="count-text">
            {{ (tag.categories?.length || 0) + (tag.products?.length || 0) + (tag.mixtures?.length || 0) }} {{ 'TAGS.RELATIONS' | translate }}
          </span>
        </div>
        <button
          (click)="$event.stopPropagation(); openDeleteDialog(tag.id)"
          class="btn-delete"
          mat-icon-button
          [matTooltip]="'COMMON.DELETE' | translate"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>
  </div>
</div>
