<div class="email-admin-container">
  <div class="admin-header-section list-header">
    <div class="admin-header-content">
      <div class="admin-title-section">
        <h1>{{ 'EMAILS.ADMIN.TITLE' | translate }}</h1>
        <p class="admin-subtitle">{{ 'EMAILS.ADMIN.SUBTITLE' | translate }}</p>
      </div>
    </div>
  </div>

  <div class="admin-content-card">
    <form *ngIf="emailForm" (ngSubmit)="onSave()" [formGroup]="emailForm" id="emailForm">
      <div class="form-content">
        <mat-progress-bar *ngIf="saving" class="admin-save-progress" mode="indeterminate"></mat-progress-bar>

        <!-- Email Type -->
        <div class="form-section">
          <div class="section-header">
            <mat-icon>drafts</mat-icon>
            <h3>{{ 'EMAILS.ADMIN.SELECT_EMAIL_TYPE' | translate }}</h3>
          </div>
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field full-width">
              <mat-label>{{ 'EMAILS.ADMIN.EMAIL_TYPE' | translate }}</mat-label>
              <mat-select formControlName="emailType" (selectionChange)="onEmailTypeChange()" required>
                <mat-option *ngFor="let emailType of emailTypes" [value]="emailType">
                  {{ 'EMAILS.TYPES.' + emailType | translate }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="emailForm.get('emailType')?.hasError('required')">
                {{ 'VALIDATION.REQUIRED' | translate }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Show/Hide Animated Email Content -->

        <div class="form-section" *ngIf="emailForm.get('emailType')?.value">
          <div class="section-header">
            <mat-icon>create</mat-icon>
            <h3>{{ 'EMAILS.ADMIN.EMAIL_CONTENT' | translate }}</h3>
          </div>

          <mat-error *ngIf="usedLocales.length === 0" class="error-message">
            <mat-icon>error_outline</mat-icon>
            {{ 'CONFIGURATION.SELECT_DEFAULT_LANGUAGE' | translate }}
          </mat-error>

          <mat-tab-group *ngIf="usedLocales.length > 0" class="locale-tabs">
            <mat-tab *ngFor="let locale of usedLocales" [label]="locale.translatedName">
              <div class="tab-content">
                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field full-width">
                    <mat-label>{{ 'EMAILS.ADMIN.SUBJECT' | translate }}</mat-label>
                    <input matInput
                           [formControlName]="'name_' + locale.languageCode + '_' + locale.regionCode"
                           [placeholder]="'EMAILS.ADMIN.SUBJECT_PLACEHOLDER' | translate"
                           required>
                    <mat-error
                      *ngIf="emailForm.get('name_' + locale.languageCode + '_' + locale.regionCode)?.hasError('required')">
                      {{ 'VALIDATION.REQUIRED' | translate }}
                    </mat-error>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field full-width">
                    <mat-label>{{ 'EMAILS.ADMIN.BODY' | translate }}</mat-label>
                    <textarea matInput
                              rows="12"
                              [formControlName]="'description_' + locale.languageCode + '_' + locale.regionCode"
                              [placeholder]="'EMAILS.ADMIN.BODY_PLACEHOLDER' | translate"
                              required></textarea>
                    <mat-error
                      *ngIf="emailForm.get('description_' + locale.languageCode + '_' + locale.regionCode)?.hasError('required')">
                      {{ 'VALIDATION.REQUIRED' | translate }}
                    </mat-error>
                  </mat-form-field>
                </div>
                <div [@previewToggle]="showPreview ? 'visible' : 'hidden'" class="animated-form-content">
                  <div class="form-row">
                    <div class="email-preview">
                      <h4>{{ 'EMAILS.ADMIN.PREVIEW' | translate }}</h4>
                      <div class="preview-content">
                        <div class="preview-subject">
                          <strong>{{ 'EMAILS.ADMIN.SUBJECT' | translate }}:</strong>
                          {{ emailForm.get('name_' + locale.languageCode + '_' + locale.regionCode)?.value }}
                        </div>
                        <div class="preview-body">
                          <strong>{{ 'EMAILS.ADMIN.BODY' | translate }}:</strong>
                          <div class="html-preview"
                               [innerHTML]="emailForm.get('description_' + locale.languageCode + '_' + locale.regionCode)?.value | safeHtml">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </mat-tab>
          </mat-tab-group>
        </div>

        <!-- Preview Toggle -->
        <div class="form-row checkboxes-row">
          <div class="checkbox-group">
            <mat-checkbox formControlName="showPreview" (change)="onPreviewToggle()">
              {{ 'EMAILS.ADMIN.SHOW_PREVIEW' | translate }}
            </mat-checkbox>
          </div>
        </div>
      </div>
    </form>
    <div class="admin-actions-bar">
      <div class="admin-action-buttons">
        <button (click)="openCancelDialog()"
                color="warn"
                mat-stroked-button
                type="button"
                class="cancel-btn">
          <mat-icon>close</mat-icon>
          {{ 'COMMON.CANCEL' | translate }}
        </button>
        <button [disabled]="!emailForm || emailForm.invalid || saving || !emailForm.get('emailType')?.value"
                color="primary"
                form="emailForm"
                mat-flat-button
                type="submit"
                class="save-btn">
          <mat-icon>save</mat-icon>
          {{ saving ? ('COMMON.SAVING' | translate) : ('COMMON.SAVE' | translate) }}
        </button>
      </div>
    </div>
  </div>
</div>

