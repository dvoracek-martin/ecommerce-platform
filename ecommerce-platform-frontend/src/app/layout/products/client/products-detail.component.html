<div class="product-detail-wrapper">
  <!-- Main content container -->
  <div class="product-detail-container">
    <mat-card class="product-card">
      <!-- Header -->
      <div class="admin-header-section" *ngIf="product">
        <div class="admin-header-content">
          <div class="admin-title-section">
            <h1>{{ product.translatedName }}</h1>
            <p class="admin-subtitle">{{ 'PRODUCTS.ADMIN_SUBTITLE.CREATE' | translate }}</p>
          </div>
        </div>
      </div>

      <mat-divider></mat-divider>

      <!-- Loading state -->
      <div *ngIf="loading" class="loading-section">
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        <div class="loading-text">Loading product details...</div>
      </div>

      <!-- Error state -->
      <div *ngIf="error" class="error-section">
        <mat-icon class="error-icon" color="warn">error_outline</mat-icon>
        <div class="error-text">{{ error }}</div>
        <button (click)="backToList()" color="warn" mat-stroked-button>
          <mat-icon>arrow_back</mat-icon>
          Back to Products
        </button>
      </div>

      <!-- Product details with floating carousel -->
      <div *ngIf="product" class="form-one-column-wrapper">
        <div class="row">
          <!-- Floated carousel -->
          <div class="float-image right" *ngIf="product.media?.length">
            <div class="product-image-container" (click)="openGallery()">
              <div class="carousel-slides" [style.transform]="'translateX(' + (-activeSlideIndex * 100) + '%)'">
                <div *ngFor="let media of product.media; let i = index" class="slide">
                  <img *ngIf="media.contentType?.startsWith('image/')"
                       [alt]="product.translatedName"
                       [src]="'data:' + media.contentType + ';base64,' + media.base64Data"
                       class="product-image"/>
                  <video *ngIf="media.contentType?.startsWith('video/')"
                         [muted]="true"
                         autoplay
                         loop
                         playsinline
                         preload="metadata"
                         class="product-image">
                    <source
                      [src]="'data:' + media.contentType + ';base64,' + media.base64Data"
                      [type]="media.contentType"/>
                  </video>
                </div>
              </div>

              <!-- Navigation arrows -->
              <div *ngIf="product.media.length > 1" class="carousel-nav">
                <button class="nav-btn prev" (click)="$event.stopPropagation(); prevSlide()">
                  <mat-icon>chevron_left</mat-icon>
                </button>
                <button class="nav-btn next" (click)="$event.stopPropagation(); nextSlide()">
                  <mat-icon>chevron_right</mat-icon>
                </button>
              </div>

              <!-- Gallery icon overlay -->
              <div class="gallery-overlay" (click)="openGallery(); $event.stopPropagation()">
                <mat-icon>zoom_out_map</mat-icon>
              </div>
            </div>
          </div>

          <!-- Text content wrapping around image -->
          <div class="text-content">
            <!-- Description -->
            <div *ngIf="product.translatedDescription">
              <h3>
                <mat-icon>description</mat-icon>
                Description
              </h3>
              <p>{{ product.translatedDescription }}</p>
            </div>

            <mat-divider></mat-divider>

            <!-- Product Details -->
            <div *ngIf="product.weightGrams" class="card-details">
              <h3>
                <mat-icon>info</mat-icon>
                Product Details
              </h3>
              <div class="detail-row">
                <span class="detail-label">Weight:</span>
                <span class="detail-value">{{ product.weightGrams }} g</span>
              </div>
            </div>

            <mat-divider></mat-divider>

            <!-- Tags Section -->
            <div *ngIf="product.responseTagDTOS?.length" class="card-details">
              <h3>
                <mat-icon>label</mat-icon>
                Tags
              </h3>
              <div *ngIf="product.responseTagDTOS?.length">
                <div class="tags-container">
                  <span *ngFor="let tag of product.responseTagDTOS" class="tag">
                    {{ tag.translatedName }}
                  </span>
                </div>
              </div>
            </div>

            <mat-divider></mat-divider>
          </div>
        </div>
      </div>


      <!-- Back button at bottom -->
      <div *ngIf="product" class="actions-section">
        <button (click)="backToList()" mat-stroked-button class="navigate-back-btn">
          <mat-icon>arrow_back</mat-icon>
          Back to Products
        </button>
      </div>
    </mat-card>
  </div>

  <!-- Floating Purchase Box (right) -->
  <div class="floating-purchase-box" *ngIf="product">
    <button (click)="addToCart()" color="primary" class="add-to-cart-btn">
      <mat-icon>add_shopping_cart</mat-icon>
      Add to Cart
    </button>
    <div class="price" *ngIf="product.price">
      {{ product.price | currency }}
    </div>
  </div>
</div>

<!-- Full-screen Gallery Modal -->
<div class="gallery-modal" [class.active]="isGalleryOpen">
  <div class="gallery-content">
    <button class="popup-close-btn" (click)="closeGallery()">
      <mat-icon>close</mat-icon>
    </button>

    <div class="gallery-main-image">
      <img *ngIf="product?.media[activeSlideIndex]?.contentType?.startsWith('image/')"
           [src]="'data:' + product.media[activeSlideIndex].contentType + ';base64,' + product.media[activeSlideIndex].base64Data"
           [alt]="product.translatedName"
           class="gallery-image"/>
      <video *ngIf="product?.media[activeSlideIndex]?.contentType?.startsWith('video/')"
             [muted]="true"
             autoplay
             loop
             controls
             class="gallery-image">
        <source
          [src]="'data:' + product.media[activeSlideIndex].contentType + ';base64,' + product.media[activeSlideIndex].base64Data"
          [type]="product.media[activeSlideIndex].contentType"/>
      </video>
    </div>

    <div class="gallery-controls">
      <button class="nav-btn prev" (click)="prevSlide()" *ngIf="product?.media.length > 1">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button class="nav-btn next" (click)="nextSlide()" *ngIf="product?.media.length > 1">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>

    <div class="gallery-thumbnails" *ngIf="product?.media.length > 1">
      <div *ngFor="let media of product.media; let i = index"
           class="thumbnail"
           [class.active]="i === activeSlideIndex"
           (click)="goToSlide(i)">
        <img *ngIf="media.contentType?.startsWith('image/')"
             [src]="'data:' + media.contentType + ';base64,' + media.base64Data"
             [alt]="'Thumbnail ' + (i + 1)"/>
        <div *ngIf="media.contentType?.startsWith('video/')" class="video-thumbnail">
          <mat-icon>play_circle_outline</mat-icon>
        </div>
      </div>
    </div>
  </div>
</div>
