<div class="admin-container">
  <mat-card class="admin-card">
    <!-- Header Section -->
    <div class="admin-header-section">
      <div class="admin-header-content">
        <div class="admin-title-section">
          <h1>{{ 'ORDER_DETAIL.TITLE' | translate:{id: order?.id} }}</h1>
          <p class="admin-subtitle">{{ 'ORDER_DETAIL.ORDER_DATE' | translate }}: {{ formatOrderDate(order?.orderDate) }}</p>
        </div>

        <div class="admin-status-section">
          <div class="status-badge" [ngClass]="getStatusClass(order?.status)">
            <mat-icon class="status-icon">{{ getStatusIcon(order?.status) }}</mat-icon>
            {{ getStatusText(order?.status) }}
          </div>
          <div class="admin-totals">
            <div class="total-label">{{ 'ORDER_DETAIL.TOTAL' | translate }}</div>
            <div class="total-amount">{{ order?.finalTotal | swissCurrency }}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="order-layout-wrapper">
      <div class="order-main-content-wrapper">
        <div *ngIf="isLoading" class="admin-loading-section">
          <mat-progress-bar mode="indeterminate"></mat-progress-bar>
          <div class="admin-loading-text">{{ 'ORDER_DETAIL.LOADING' | translate }}</div>
        </div>

        <div *ngIf="isOrderLoaded && !order" class="admin-empty-state">
          <mat-icon class="empty-icon">search_off</mat-icon>
          <h3>{{ 'ORDER_DETAIL.NOT_FOUND_TITLE' | translate }}</h3>
          <p>{{ 'ORDER_DETAIL.NOT_FOUND_DESCRIPTION' | translate }}</p>
        </div>

        <div *ngIf="isOrderLoaded && order" class="order-content">
          <!-- Order Items Section -->
          <div class="form-section">
            <h3 class="section-subtitle">
              <mat-icon>shopping_cart</mat-icon>
              {{ 'ORDER_DETAIL.ITEMS' | translate }}
            </h3>
            <div class="order-items">
              <div *ngFor="let item of orderItemsWithDetails; trackBy: trackByItemId"
                   class="order-item"
                   [class.mixture-item]="item.cartItemType === CartItemType.MIXTURE">

                <div class="item-media" (click)="navigateToProduct(item.product)"
                     *ngIf="item.cartItemType === CartItemType.PRODUCT && item.product">
                  <img *ngIf="item.product?.media?.[0]"
                       [src]="'data:' + item.product.media[0].contentType + ';base64,' + item.product.media[0].base64Data"
                       [alt]="item.translatedName"/>
                  <div *ngIf="!item.product?.media?.[0]" class="no-image">
                    <mat-icon>inventory_2</mat-icon>
                  </div>
                </div>

                <div class="item-media" *ngIf="item.cartItemType !== CartItemType.PRODUCT || !item.product">
                  <ng-container *ngIf="item.product || item.mixture">
                    <img *ngIf="(item.product?.media?.[0]) || (item.mixture?.products?.[0]?.media?.[0])"
                         [src]="item.product?.media?.[0] ? 'data:' + item.product.media[0].contentType + ';base64,' + item.product.media[0].base64Data :
                               (item.mixture?.products?.[0]?.media?.[0] ? 'data:' + item.mixture.products[0].media[0].contentType + ';base64,' + item.mixture.products[0].media[0].base64Data : '')"
                         [alt]="item.translatedName"/>
                  </ng-container>
                  <div *ngIf="!((item.product?.media?.[0]) || (item.mixture?.products?.[0]?.media?.[0]))"
                       class="no-image">
                    <mat-icon *ngIf="item.cartItemType === CartItemType.PRODUCT">inventory_2</mat-icon>
                    <mat-icon *ngIf="item.cartItemType === CartItemType.MIXTURE">blender</mat-icon>
                  </div>
                </div>

                <div class="item-info">
                  <div class="item-header">
                    <h3 class="item-name"
                        (click)="navigateToProduct(item.product)"
                        *ngIf="item.cartItemType === CartItemType.PRODUCT && item.product">
                      {{ item.translatedName }}
                    </h3>

                    <h3 class="item-name" *ngIf="item.cartItemType !== CartItemType.PRODUCT || !item.product">
                      {{ item.translatedName }}
                    </h3>
                    <div class="item-price">{{ item.itemPrice | swissCurrency }}</div>
                  </div>
                  <div class="item-description truncate-text" *ngIf="item.product?.translatedDescription"
                       [title]="item.product.translatedDescription">
                    {{ item.product.translatedDescription }}
                  </div>

                  <div *ngIf="item.cartItemType === CartItemType.MIXTURE && item.mixture" class="mixture-display">
                    <h4>{{ 'ORDER_DETAIL.MIXTURE_CONTAINS' | translate }}</h4>
                    <div class="mixture-products-list">
                      <div *ngFor="let mixture of item.mixture.products" class="mixture-product-item">
                        <div class="mixture-product-info">
                          <div class="mixture-product-name">{{ mixture.translatedName }}</div>
                          <div class="mixture-product-price">{{ mixture.price | swissCurrency }}</div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="item-controls">
                    <div class="item-quantity">
                      <label>{{ 'ORDER_DETAIL.QUANTITY' | translate }}:</label>
                      <div class="quantity-readonly">{{ item.quantity }}</div>
                    </div>
                    <div class="item-total">{{ getItemTotal(item) | swissCurrency }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Order Info Section -->
          <div class="form-section">
            <h3 class="section-subtitle">
              <mat-icon>info</mat-icon>
              {{ 'ORDER_DETAIL.ORDER_INFO' | translate }}
            </h3>
            <div class="info-grid">
              <div class="info-row">
                <div class="info-label">{{ 'ORDER_DETAIL.ORDER_DATE' | translate }}:</div>
                <div class="info-value">{{ formatOrderDate(order?.orderDate) }}</div>
              </div>
              <div class="info-row">
                <div class="info-label">{{ 'ORDER_DETAIL.STATUS' | translate }}:</div>
                <div class="info-value">
                  <div class="status-badge" [ngClass]="getStatusClass(order?.status)">
                    <mat-icon class="status-icon">{{ getStatusIcon(order?.status) }}</mat-icon>
                    {{ getStatusText(order?.status) }}
                  </div>
                </div>
              </div>
              <div class="info-row" *ngIf="order?.trackingNumber">
                <div class="info-label">{{ 'ORDER_DETAIL.TRACKING_NUMBER' | translate }}:</div>
                <div class="info-value">{{ order.trackingNumber }}</div>
              </div>
              <div class="info-row">
                <div class="info-label">{{ 'ORDER_DETAIL.SHIPPING_METHOD' | translate }}:</div>
                <div class="info-value">{{ order?.shippingMethod }}</div>
              </div>
              <div class="info-row">
                <div class="info-label">{{ 'ORDER_DETAIL.PAYMENT_METHOD' | translate }}:</div>
                <div class="info-value">{{ order?.paymentMethod }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Order Summary Section -->
      <div class="order-sidebar" *ngIf="isOrderLoaded && order">
        <!-- Order Summary -->
        <div class="form-section">
          <h3 class="section-subtitle">
            <mat-icon>receipt</mat-icon>
            {{ 'ORDER_DETAIL.ORDER_SUMMARY' | translate }}
          </h3>
          <div class="summary-card">
            <div class="summary-row">
              <span>{{ 'ORDER_DETAIL.SUBTOTAL' | translate }}:</span>
              <span>{{ getOrderSubtotal() | swissCurrency }}</span>
            </div>
            <div class="summary-row">
              <span>{{ 'ORDER_DETAIL.SHIPPING' | translate }}:</span>
              <span>{{ order?.shippingCost | swissCurrency }}</span>
            </div>
            <div class="summary-row total">
              <span>{{ 'ORDER_DETAIL.TOTAL' | translate }}:</span>
              <span>{{ order?.finalTotal | swissCurrency }}</span>
            </div>
          </div>
        </div>

        <!-- Invoice Download Section -->
        <div class="form-section">
          <h3 class="section-subtitle">
            <mat-icon>description</mat-icon>
            {{ 'ORDER_DETAIL.INVOICE' | translate }}
          </h3>
          <button mat-flat-button
                  color="primary"
                  (click)="downloadInvoice(order.id)"
                  class="action-btn download-btn">
            <mat-icon>download</mat-icon>
            {{ 'ORDER_DETAIL.DOWNLOAD_INVOICE' | translate }}
          </button>
        </div>

        <!-- Back to Orders Button -->
        <div class="form-section">
          <button (click)="navigateBackToList()"
                  mat-stroked-button
                  class="back-btn">
            <mat-icon>arrow_back</mat-icon>
            {{ 'COMMON.BACK_TO_ORDERS' | translate }}
          </button>
        </div>
      </div>
    </div>
  </mat-card>
</div>
